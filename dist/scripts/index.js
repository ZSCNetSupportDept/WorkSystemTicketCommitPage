(function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a})({1:[function(a,b){let c=a("./url");(function(){function a(a){let b="";document.cookie&&document.cookie.split(";").filter((a)=>a.trim().startsWith(f)).map((a)=>b=a.slice(f.length)),!b&&a&&a.csrf_token&&(document.cookie=`${f}${b=a.csrf_token}`),h=b||h}function d(a,b){return new Promise((d,f)=>{let g=c.createRequestOptions(a,h);b&&(g.data=JSON.stringify(b)),g.success=e(a,d),g.error=(a)=>(console.error(a),f("\u65E0\u6CD5\u8FDE\u63A5\u5230\u670D\u52A1\u5668!(\u670D\u52A1\u5668\u5F02\u5E38)")),$.ajax(g)})}function e(b,c){return(d)=>{console.log(`API ${b} response:\n`,d),d&&"undefined"!=typeof d.is_login&&(g=d.is_login),a(d),c(d)}}const f="csrftoken=";let g=!1,h="";b.exports={getStauts:function(){return d("is_login",null)},login:function(a){return d("login",Object.assign({},a,{longtime:!1}))},commit:function(a){return d("work_order_add",a)},logout:function(){return d("logout",null)},get isLogin(){return g},set csrf(a){h=a},get csrf(){return h}}})()},{"./url":9}],2:[function(a,b){let{isValueTag:c}=a("./form");b.exports={init:function(a){function b(){let b=a.find(`[name]`);b.each((b,g)=>{let e=$(g),h=e.attr("name"),j=c(e)?e.val():e.text(),k=e.data("color"),i=a.find(`[data-bind="${h}"]`);i.each((a,b)=>{let c=$(b),e=f(k);c.text()==j?(c.removeClass(d),c.addClass(e)):(c.addClass(d),c.removeClass(e))})})}let d=`btn-outline-secondary`,f=(a)=>`btn-${a}`;a.find("[data-bind]").off("click").on("click",function(){let d=$(this),e=a.find(`[name="${d.data("bind")}"]`),f=d.text();c(e)?e.val(f):e.text(f),b()}),b()}}},{"./form":4}],3:[function(a,b){(function(){let a=$("#txtTicketDesc"),c=$("#blockConfirm"),d=$("#commitSuccess"),e=$("#btnCommit");b.exports={show:function(){a.attr("disabled","disabled"),$(".hide-on-confirm").css("opacity",0.4),d.hide(),e.removeAttr("disabled").show(),c.slideDown()},hide:function(){a.removeAttr("disabled"),$(".hide-on-confirm").css("opacity",1),c.slideUp()},commitSuccess:function(){e.hide(),d.show()},commitFailed:function(){e.removeAttr("disabled").show()},commiting:function(){e.attr("disabled","disabled")},get isShowing(){return!1}}})()},{}],4:[function(a,b){function c(a){let b=a.prop("tagName");return"INPUT"==b||"TEXTAREA"==b||"SELECT"==b}let d=function(){const a=`中国`;return{add_china_prefix:(b)=>b.startsWith(a)?b:`${a}${b}`,remove_china_prefix:(b)=>b.startsWith(a)?b.replace(a,""):b}}();b.exports={encode:function(a){let b={};return a.find("[name]").each((a,e)=>{let f,g=$(e),h=c(g)?g.val():g.text();g.data("ignore")||((f=g.data("convert-get"))&&d[f]&&(h=d[f](h)),b[g.attr("name")]=h)}),b},fill:function(a,b){b=b||{},a.find("[name]").each((a,e)=>{let f,g=$(e),h=g.attr("name"),i=b[h]||"";g.data("ignore")||((f=g.data("convert-set"))&&d[f]&&(i=d[f](i)),c(g)?g.val(i):g.text(i))})},isValueTag:function(a){return c(a)}}},{}],5:[function(a){(function(b){let c=a("./api"),d=a("./form"),e=a("./component_btn_value_binder"),f=a("./confirm_dialog"),{analyze:g,ticketTypeMap:h}=a("./ticket_info_analyzer"),{render:i}=a("./templates");b.app=new function(){function a(){c.getStauts().then((a)=>{$("#blockUserInfo").html(i("block_user_info_"+(a.is_login?"info":"login"),a))}).catch(l)}function b(){if(!c.isLogin)return m("\u8BF7\u5148\u767B\u5F55!");let a=p.val();a.trim()&&(d.fill(q.commit,g(p.val())),e.init(q.commit),f.show())}function j(){n&&clearTimeout(n),n=setTimeout(()=>o.text(JSON.stringify(g(p.val()),(a,b)=>"introduction"==a?"...":b,"  ")),200)}function k(b){b.success?a():m(b.error)}function l(a){alert("\u670D\u52A1\u5668\u5F02\u5E38!\n\u8BE6\u7EC6\u4FE1\u606F\u8BF7\u67E5\u770B\u63A7\u5236\u53F0\u8F93\u51FA"),console.error(a)}let m=(a)=>q.login_err_msg.show().text(a),n=null,o=$("#txtDump"),p=$("#txtTicketDesc"),q={commit:$("#formCommit"),get login(){return $("#formLogin")},get login_err_msg(){return $("#formLogin .alert")}};this.api=c,this.commit=function(){function b(){r=!1,f.commitFailed(),alert("\u5F55\u5165\u5931\u8D25!\n\u8BF7\u68C0\u67E5\u5404\u4E2A\u5B57\u6BB5\u586B\u5199\u6B63\u786E,\u63CF\u8FF0\u6CA1\u6709\u8D85\u8FC7\u957F\u5EA6!")}if(!r){r=!0,f.commiting();let e=d.encode(q.commit);e.situation_order=h[e.situation_order_string]||1,e.introduction=e.introduction,e.area=e.work_area,e.status=0,console.log(e),c.commit(e).then((c)=>{return c&&c.success?void(r=!1,f.commitSuccess(),p.val(""),a()):b()}).catch(b)}},this.login=function(a){a.preventDefault(),q.login_err_msg.hide(),c.login(d.encode(q.login)).then(k).catch(m)},this.logout=function(){event.preventDefault(),c.logout().then(k).catch(l)},this.onTicketDescChange=function(a){let c=a.which||a.keyCode||0;return 13!=c||!a.ctrlKey||a.altKey||a.shiftKey?void j():(a.preventDefault(),b())},this.hideConfirmDialog=f.hide,this.previewTicketBeforeCommit=b,a(),$(document).keydown(function(a){if(a){let b=a.which||a.keyCode||0;if(27==b)return f.hide()}});let r=!1}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./api":1,"./component_btn_value_binder":2,"./confirm_dialog":3,"./form":4,"./templates":7,"./ticket_info_analyzer":8}],6:[function(a,b){b.exports={getRoomNumber:function(a){let b=null;return(b=a.match(/([A-Da-d])(?:单元|栋)?[\/\\\-\s]*([01]?\d{3})(床0?[1-4])?\b/),b)?b[1]+b[2]+(b[3]||""):(b=a.match(/([01]?\d{3})(?:房-|房|-)(0?\d)床?\b/),b)?b[1]+"\u623F"+(b[2]||""):(b=a.match(/\b(1?\d{3})(?:房)?\b/),a.match(/朝晖苑/)&&b)?b[1]+"\u623F":(b=a.match(/\b([1-6])栋[\/\\\-\s]*(\d{3})(-?[1-4])?\b/),b)?b[1]+"\u680B"+b[2]+(b[3]||""):(b=a.match(/\b([7-9]|[12]\d)\s*(?:栋|\-)\s*(\d{3})\b/),b?b[1]+"\u680B"+b[2]:"")}}},{}],7:[function(a,b){function c(){let a=$("script[type=\"text/template\"]");a.each((b)=>{let c=a.eq(b);d[c.data("tmpl")]=ejs.compile(c.html())}),e=!0}let d={},e=!1;b.exports={render:function(a,b){return e||c(),a in d?d[a](b||{}):""}}},{}],8:[function(a,b){function c(a){return m.new_account.map((b)=>k(a,b)).map(i).reduce(j,0)>=m.new_account_atleast?2:m.user_fuck.map((b)=>k(a,b)).map(i).reduce(j,0)>=m.user_fuck_atleast?3:1}function d(a){return k(a,"6\u671F\u516C\u5BD3")||k(a,"\u671D\u6656")?"\u671D\u6656\u82D1":k(a,"\u9999\u6656\u82D1")||a.match(/\b[A-Da-d]单元/)?"\u9999\u6656\u82D1":k(a,"\u51E4\u7FD4")||a.match(/\b[1-6](栋|\-)/)?"\u51E4\u7FD4":k(a,"\u5317\u95E8")||a.match(/\b([7-9]|1[01])(栋|\-)/)?"\u5317\u95E8":k(a,"\u5C90\u5934")||a.match(/\b1[6-9](栋|\-)/)?"\u5C90\u5934":k(a,"\u4E1C\u95E8")||a.match(/\b(1[2-5]|20|21)(栋|\-)/)?"\u4E1C\u95E8":k(a,"\u522B\u5885")?"\u9999\u5C71\u522B\u5885":""}function e(a){return m.from_cmcc_important.map((b)=>k(a,b)).map(i).reduce(j,0)>=m.from_cmcc_important_atleast?"\u4E2D\u56FD\u79FB\u52A8":m.from_cmcc.map((b)=>k(a,b)).map(i).reduce(j,0)>=m.from_cmcc_atleast?"\u4E2D\u56FD\u79FB\u52A8":m.from_unicom.map((b)=>k(a,b)).map(i).reduce(j,0)>=m.from_unicom_atleast?"\u4E2D\u56FD\u8054\u901A":"\u4E2D\u56FD\u7535\u4FE1"}function f(a){let b={},c=[],d=a.match(/1(?:[358]\d|4[57]|7[678])\d{8}/g);if(!d||!d.length)return{main:"",other:[]};for(let a in d.map((a)=>b[a]=(b[a]||0)+1),b)c.push({phone:a,count:b[a]});return c.sort((c,a)=>a.count-c.count),{main:c[0].phone,other:c.slice(1).map((a)=>a.phone)}}function g(a){let b=[];return(b=a.match(/\w+@(?:(?:139|16900)\.gd)/))?b[0]:""}function h(a){let b=[];return(b=a.match(/.+\b(.+?)(小姐|同学|先生)/))?(b[1]+b[2]).trim():""}function i(a){return a?1:0}function j(c,a){return c+a}function k(a,b){return 0<=a.indexOf(b)}let{getRoomNumber:l}=a("./room_number_getter"),m={new_account:["\u4E0A\u95E8\u5B89\u88C5","\u5B89\u88C5","\u65B0\u88C5","\u62A5\u88C5"],new_account_atleast:2,user_fuck:["\u6295\u8BC9"],user_fuck_atleast:1,from_cmcc_important:["CMCC","\u79FB\u52A8\u5DE5\u5355"],from_cmcc_important_atleast:1,from_cmcc:["\u79FB\u52A8\u5DE5\u5355","\u611F\u77E5\u5E73\u53F0","\u5BB6\u5EAD\u5BBD\u5E26\u4E1A\u52A1","10086","\u91CD\u542FMODEM"],from_cmcc_atleast:2,from_unicom:["@16900.gd","ZSZJLAN","\u5F20\u7433","\u8054\u901A"],from_unicom_atleast:1},n=["","\u5DE5\u5355","\u65B0\u88C5","\u6295\u8BC9"];b.exports={analyze:function(a){let b={};b.situation_order=c(a),b.situation_order_string=n[b.situation_order],b.work_area=d(a),b.operator=e(a),b.dormitory_number=l(a);let i=f(a);return b.telephone_number=i.main,b.more_phone_number=i.other,b.account_number=g(a)||b.telephone_number,b.introduction=h(a),b.status=0,b},ticketTypeMap:{工单:1,新装:2,投诉:3}}},{"./room_number_getter":6}],9:[function(a,b){let c="/work",d={base:c,is_login:`${c}/is_login/`,is_login_method:"GET",login:`${c}/try_login/`,login_method:"POST",logout:`${c}/try_logout/`,logout_method:"GET",work_order_add:`${c}/work_order_add/`,work_order_add_method:"POST",createRequestOptions:function(a,b){let c=d[a],e=d[`${a}_method`],f={url:c,method:e,dataType:"json"};return"POST"==e&&(f.contentType="application/json"),f.crossDomain=!1,f.headers={"X-CSRFToken":b},f}};b.exports=d},{}]},{},[5]);
//# sourceMappingURL=index.js.map